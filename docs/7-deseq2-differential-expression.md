# Document 7: Differential Expression Analysis with DESeq2

This document performs gene-level differential expression analysis between **WT** and **KO** samples on chromosome 21 using **DESeq2**, based on counts generated by **Salmon + tximport**.

---

## Software Setup

Install Jupyter and the R kernel:

```bash
mamba install -c conda-forge -c bioconda jupyter jupyterlab r-irkernel
````

Register the R kernel:

```bash
R -e "IRkernel::installspec(name='genomics', displayname='R (DESeq2)')"
```

Launch Jupyter:

```bash
jupyter notebook
```

Create a new notebook and select **R (DESeq2)** as the kernel.

---

## Working Directory

Set the working directory inside the notebook:

```r
setwd("~/project/genomics")
```

Create output directories:

```r
dir.create("results/tables", showWarnings = FALSE, recursive = TRUE)
```

---

## Input Files

| File                     | Description                     |
| ------------------------ | ------------------------------- |
| `counts/tximport.rds`    | Gene-level counts from tximport |
| `counts/sample_info.tsv` | Sample metadata (WT / KO)       |

---

## Load Data

```r
library(DESeq2)

txi <- readRDS("counts/tximport.rds")
sample_info <- read.table("counts/sample_info.tsv",
                           header = TRUE, sep = "\t")

sample_info$condition <- factor(sample_info$condition,
                                levels = c("WT", "KO"))
```

Dataset summary:

* Samples: 6
* Genes: 405
* Conditions: WT vs KO

---

## Create DESeq2 Dataset

```r
dds <- DESeqDataSetFromTximport(
  txi,
  colData = sample_info,
  design = ~ condition
)
```

---

## Pre-filtering Low-Count Genes

Remove genes with low expression:

```r
keep <- rowSums(counts(dds) >= 10) >= 3
dds <- dds[keep, ]
```

Genes after filtering: **135**

---

## Differential Expression Analysis

Run DESeq2:

```r
dds <- DESeq(dds)
res <- results(dds, contrast = c("condition", "KO", "WT"))
res <- res[order(res$padj), ]
```
Mathematically means expression in KO relative to WT. KO is the condition of interest.

WT = normal state (TDP-43 present). KO = perturbed state (TDP-43 removed)

---

## Significance Thresholds

Genes were considered significant if:

* `padj < 0.05`
* `|log2FoldChange| > 1`

```r
sig_genes <- subset(res, padj < 0.05 & abs(log2FoldChange) > 1)
```

Results:

* Significant genes: **7**
* Upregulated in KO: **5**
* Downregulated in KO: **2**

---

## Output Files

All results were written to `results/tables/`:

```r
write.csv(as.data.frame(res),
          "results/tables/deseq2_all_results.csv",
          row.names = TRUE)

write.csv(as.data.frame(sig_genes),
          "results/tables/deseq2_significant.csv",
          row.names = TRUE)

norm_counts <- as.data.frame(counts(dds, normalized = TRUE))
write.csv(norm_counts,
          "results/tables/normalized_counts.csv",
          row.names = TRUE)
```

---

## Significant Gene Table

The file `results/tables/deseq2_significant.csv` contains genes that passed the significance thresholds
(`padj < 0.05` and `|log2FoldChange| > 1`).

Content:

| gene_id | baseMean | log2FoldChange | padj |
|---|---|---|---|
| ENSG00000160183 | 653.23 | +1.26 | 2.28e-33 |
| ENSG00000142156 | 167.95 | +1.76 | 9.29e-21 |
| ENSG00000154736 | 39.07 | −3.28 | 1.26e-12 |
| ENSG00000160233	| 45.20	| -1.36	| 5.01e−04 |
| ENSG00000154654 | 70.25 | +1.17 | 2.17e-03 |
| ENSG00000185437 | 57.06 | +1.32 | 3.16e-03 |
| ENSG00000183486 | 12.47 | +2.42 | 8.57e-03 |

---

## Interpretation of DESeq2 Output

- **Positive log2FoldChange**: gene is upregulated in KO  
- **Negative log2FoldChange**: gene is downregulated in KO  
- **padj < 0.05**: statistically significant after multiple testing correction  
- **|log2FoldChange| > 1**: at least 2-fold change in expression  

---

## Biological Interpretation

TDP-43 is an RNA-binding protein involved in RNA processing and regulation.

- The genes **upregulated in KO** may be normally suppressed by TDP-43  
- The genes **downregulated in KO** may depend on TDP-43 for proper expression or RNA stability  

These results indicate that TDP-43 loss affects a small but specific subset of chromosome 21 genes.
